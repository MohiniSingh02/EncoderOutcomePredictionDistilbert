command:
  - ${env}
  - "python"
  - "-m"
  - "src/classification_main.py"
  - "fit"
  {% if multitask %}
  - "--config=src/config_multitask_{{ mimic_split }}.yaml"
  - "--data.multitask=true"
  - "--data.icd9_data_dir=/data-pvc/data/mimic-iv/icd9/{{ mimic_split }}"
  - "--data.icd10_data_dir=/data-pvc/data/mimic-iv/icd10/{{ mimic_split }}"
  {% else %}
  - "--config=src/config_{{ icd_version }}.yaml"
  - "--data.data_dir=/data-pvc/data/mimic-iv/{{ icd_version }}/{{ mimic_split }}/"
  {% endif %}
  - "--trainer.default_root_dir=/model-pvc/{{ icd_version }}-{{ mimic_split }}{% if multitask %}-multitask{% endif %}"
  - "--trainer.max_epochs=20"
  - "--data.truncate_again={{ truncate_again }}"
  - "--data.pretrained_model={{ model }}"
  - "--model.lr=${lr}"
  - "--model.warmup_steps=${warmup_steps}"
  - "--model.weight_decay=${weight_decay}"
  - "--model.decay_steps=${decay_steps}"
  - "--data.batch_size=${batch_size}"



method: bayes


metric:
  name: {% if multitask %}Val/HARMONIC/AUROC{% else %}Val/AUROC{% endif %}
  goal: maximize


parameters:
  lr:
    min: !!float 1e-6
    max: !!float 1e-3
    distribution: log_uniform_values

  warmup_steps:
    min: 0
    max: 5000

  weight_decay:
    min: !!float 1e-4
    max: !!float 0.1
    distribution: log_uniform_values

  decay_steps:
    values: [10000, 20000, 30000, 40000, 50000]

  batch_size:
    values: [16, 32, 64, 128]

program: classification_main.py

project: EncoderOutcomePred
entity: s90444-berliner-hochschule-f-r-technik

name: >
  {% if multitask %}
  multitask_{{ mimic_split }}
  {% else %}
  {{ icd_version }}_{{ mimic_split }}
  {% endif %}



